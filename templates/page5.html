<!DOCTYPE html>
<html>
<head>
  <title>다섯번째 페이지</title>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!-- google font -->
  <link href="https://fonts.googleapis.com/css?family=Gamja+Flower&display=swap&subset=korean" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Poor+Story&display=swap&subset=korean" rel="stylesheet">

  <!-- 추가한 부분 -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
  rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">

  <!-- JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
  crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
  crossorigin="anonymous"></script>

  <!-- 추가한 부분 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


  <script>


   let movie_infos = new Array()
   let Mtype=""

   let pencil_image = `<svg class="bi bi-pencil" width="1.5em" height="1.5em" style="padding-top:5px;" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
   <path fill-rule="evenodd" d="M11.293 1.293a1 1 0 0 1 1.414 0l2 2a1 1 0 0 1 0 1.414l-9 9a1 1 0 0 1-.39.242l-3 1a1 1 0 0 1-1.266-1.265l1-3a1 1 0 0 1 .242-.391l9-9zM12 2l2 2-9 9-3 1 1-3 9-9z"/>
   <path fill-rule="evenodd" d="M12.146 6.354l-2.5-2.5.708-.708 2.5 2.5-.707.708zM3 10v.5a.5.5 0 0 0 .5.5H4v.5a.5.5 0 0 0 .5.5H5v.5a.5.5 0 0 0 .5.5H6v-1.5a.5.5 0 0 0-.5-.5H5v-.5a.5.5 0 0 0-.5-.5H3z"/>
   </svg>`

   let trash_can_image = `<svg class="bi bi-trash" width="1.5em" height="1.5em" style="padding-top:5px; "viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
   <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
   <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4L4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
   </svg>`

   let edit_pencil_image = `<svg class="bi bi-pencil-square" width="1.5em" height="1.5em" style="padding-top:5px;" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
   <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
   <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
   </svg>`

   let speaker_image = `<svg width="3em" height="3em" style="margin-left:3px; margin-right:3px;" viewBox="0 0 16 16" class="bi bi-speaker" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
   <path d="M9 4a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-2.5 6.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0z"/>
   <path fill-rule="evenodd" d="M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm6 4a2 2 0 1 1-4 0 2 2 0 0 1 4 0zM8 7a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z"/>
   </svg>`

   let tv_image = `<svg width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-display" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
   <path d="M5.75 13.5c.167-.333.25-.833.25-1.5h4c0 .667.083 1.167.25 1.5H11a.5.5 0 0 1 0 1H5a.5.5 0 0 1 0-1h.75z"/>
   <path fill-rule="evenodd" d="M13.991 3H2c-.325 0-.502.078-.602.145a.758.758 0 0 0-.254.302A1.46 1.46 0 0 0 1 4.01V10c0 .325.078.502.145.602.07.105.17.188.302.254a1.464 1.464 0 0 0 .538.143L2.01 11H14c.325 0 .502-.078.602-.145a.758.758 0 0 0 .254-.302 1.464 1.464 0 0 0 .143-.538L15 9.99V4c0-.325-.078-.502-.145-.602a.757.757 0 0 0-.302-.254A1.46 1.46 0 0 0 13.99 3zM14 2H2C0 2 0 4 0 4v6c0 2 2 2 2 2h12c2 0 2-2 2-2V4c0-2-2-2-2-2z"/>
   </svg>`

   $(document).ready(function(){
    search_movie = $('#movie_input').val();

    get_session();
    get_parameter();
    lastest_searching_listing();


    $('#movie_temp_html').html('');
    // $('#search_movie_title').text('');
    $('#comment_movie_title').text('');

  });

   function like_animation(){
    $('#like').toggleClass('is-active');
    check_like();
  };

  // 좋아요를 누른 영화와 누르지 않은 영화를 나눠서 like/dislike 나누는 함수
  function check_like(){
    if($('#like').hasClass('is-active')){
      like_movie();

    }else{
      dislike_movie();
    }
  }

  //영화에 들어왔는데, 좋아요를 누른 영화라면 
  function check_like_db(){
    $.ajax({
     type: "POST",
     url: "/check_LDDB",
     data: {
      title:movie_infos[0]['title'],
      poster:movie_infos[0]['poster'],
      director:movie_infos[0]['director']
    },
    success: function(response){
      if(response['result']=='like_success'){
        $('#like').toggleClass('is-active');
      }else{
      }
    }
  })
    
  }

  function movie_card(poster,title,summary,director){
    let temp_html_1 = '<div class="card mb-3">\
    <div class="row no-gutters" id="card_size">\
    <div class="col-md-4">\
    <img src="'+poster+'" class="card-img" id="movie_poster" style="position:relative;"alt="...">\
    <div class="container" style="text-align:center; position:absolute; top:10px; right:-265px;">\
    <div class="wrapper" style="display:inline-block; vertical-align:middle;">\
    <a href="javascript:void(0);" onclick="like_animation()" class="like-button" id="like" style="margin-bottom:20px; margin-left:10px;">\
    <i class="material-icons not-liked bouncy">favorite_border</i>\
    <i class="material-icons is-liked bouncy">favorite</i>\
    <span class="like-overlay"></span>\
    </a>\
    </div>\
    </div>\
    </div>\
    <div class="col-md-8">\
    <div class="card-body">\
    <div class="card-title" style="">\
    <h1 class="card_title" id="card_movie_title" style="font-weight:bold;">'+title+'\
    </h1>\
    </div>\
    <h3 class="card-text" id="card-director" style="text-align:right;"><small class="text-muted">'+director+'</small></h3><br>\
    <p class="card-text">'+summary+'</p>\
    <button id="namu_wiki_link" onclick="namu_wiki_click()"><img src="static/namu_wiki.jfif"\
    style="width:50px; height:50px; cursor:pointer;"></button>\
    <button id="google_link" onclick="google_click()" style="margin-right: 3px; cursor:pointer;"><img src="static/google_logo.webp"\
    style="width:50px; height:50px;"></button>\
    <button id="comment_button" onclick="btn_comment()">코멘트 남기기'+pencil_image+'</button>\
    </div>\
    </div>\
    <div class="watching_site" style="text-align: center; margin-top: 50px; margin-right: auto; margin-left: auto; margin-bottom:50px;border:1px solid black; padding : 20px 10px">\
    '+speaker_image+'\
    '+tv_image+'\
    '+speaker_image+'\
    <h4 style="font-weight: bold; margin-top:10px;">이 영화를 보고 싶다면, <a style="color:blue">버튼</a>을 눌러주세요.</h4>\
    <button style="margin-top:20px;margin-bottom:10px;" onclick="google_click()">영화보러가기</button>\
    </div>\
    </div>\
    </div>'
    $('#movie_temp_html').append(temp_html_1);
    get_others_comment(title)
  }

  function btn_comment(){
    if ( $('#comment_box').css('display') == 'block' ) {
      $('#comment_box').hide();
    } else {
      $('#comment_box').show();
    }
  }

  function comment_save(title,poster,director,comment){
    $('#save_button').hide()
    $.ajax({
      type: "POST",
      url: "/comment_save",
      data: { nickname :$('#customer_email').text(),user_comment_movie_title : title ,user_comment_movie_poster: poster, user_comment_movie_director: director ,user_comment_give : comment},
      success: function(response){
          // 처음 저장하는 코멘트일 경우
          if (response['result']== 'success'){
            if(response['edit'] == true){
              $('#user_comment').hide()
              comment_box_html = '<div id="db_comment_box">\
              <h3 id="db_comment">'+comment+'</h3>\
              <br>\
              <button id="comment_edit" onclick="edit_card()">수정'+edit_pencil_image+'</button>\
              <button id="comment_remove" onclick="comment_remove()">삭제'+trash_can_image+'</button>\
              </div>'
              $('#user_comment_box').append(comment_box_html)
              //alert('코멘트를 수정했습니다.')
            }
            else{
              $('#user_comment').hide()
              comment_box_html = '<div id="db_comment_box">\
              <h3 id="db_comment">'+comment+'</h3>\
              <br>\
              <button id="comment_edit" onclick="edit_card()">수정'+edit_pencil_image+'</button>\
              <button id="comment_remove" onclick="comment_remove()">삭제'+trash_can_image+'</button>\
              </div>'
              $('#user_comment_box').append(comment_box_html)

              // 새로고침
              location.reload();
            }
          }
          // 이미 작성한 코멘트가 있는 영화일 경우
          else{
            test_comment = response['comment']
            $('#user_comment').hide()
            comment_box_html = '<div id="db_comment_box">\
            <h3 id="db_comment">'+comment+'</h3>\
            <br>\
            <button id="comment_edit" onclick="edit_card()">수정'+edit_pencil_image+'</button>\
            <button id="comment_remove" onclick="comment_remove()">삭제'+trash_can_image+'</button>\
            </div>'
            $('#user_comment_box').append(comment_box_html)
          }
        }
      })


  }

  function comment_info(){
    let user_comment = $('#user_comment').val()
    let user_comment_movie = $('#comment_movie_title').text()
    let user_comment_movie_poster = document.getElementById('movie_poster').getAttribute('src')
    let user_comment_movie_director = $('#card-director').text()
    comment_save(user_comment_movie,user_comment_movie_poster,user_comment_movie_director,user_comment)

  }

  function edit_comment_info(){
    location.reload();

    let edit_user_comment = $('#edit_user_comment').val()
    let user_comment_movie = $('#comment_movie_title').text()
    let user_comment_movie_poster = document.getElementById('movie_poster').getAttribute('src')
    let user_comment_movie_director = $('#card-director').text()
    comment_save(user_comment_movie, user_comment_movie_poster, user_comment_movie_director,edit_user_comment)

  }

  function edit_card(){

    db_comment = $('#db_comment').text()

    alert('코멘트를 수정해주세요. (최소 30자 ,최대 500자)')
    edit_comment_html ='<div id="edit_comment_box">\
    <p id="edit_user_comment_box">\
    <textarea name="txtarea" class="comment_area" id="edit_user_comment">'+db_comment+'</textarea>\
    </p><br>\
    <a class="btn btn-primary btn-lg" href="#" role="button" onclick="edit_user_comment()">저장하기</a>\
    </div>'
    $('#user_comment_box').append(edit_comment_html)
    $('#save_button').hide()
    $('#db_comment_box').remove()
  }

  function edit_user_comment(){
    let user_edit_comment = $('#edit_user_comment').val()
    $.ajax({
      type:"POST",
      url:"/comment_edit",
      data:{nickname:$('#customer_email').text(),edit_movie:$('#comment_movie_title').text(),edit_comment:user_edit_comment},
      success: function(response){
        $('#edit_comment_box').hide()
        edit_comment_info()
      }
    })
  }


  function comment_remove(){
    alert('정말 코멘트를 삭제하시겠습니까?')
    let db_comment = $('#db_comment').text()
    $.ajax({
      type:"POST",
      url:"/comment_remove",
      data:{user_comment: db_comment},
      success: function(response){
        $('#user_comment').val('')
        $('#user_comment').show()
        $('#save_button').show()
        $('#db_comment_box').remove()
      }
    })
    location.reload();
  }
  function btn_main(){
    location.href="/"
  }

  function btn_home(){
    location.href="/temp"
  }

  function btn_mypage(nickname){
    location.href="/mypage?user="+nickname
  }

  function go_search_page(data){
    location.href="/search_page?search_data="+data
  }

  function go_page5(data){
    location.href="/page5?search_data="+data
  }

  function get_session(){
    nickname = "{{sessionemail2}}"
    non_login = '<a class="nav-link" href="/" id="btn_main" onclick="btn_main()">로그인을 해야 사용가능합니다.</a>'
    html_logout = '<a class="nav-link" style="cursor:pointer;"id="btn_logout" onclick="btn_logout()">로그아웃</a>'
    if("{{sessionemail2}}" == ""){
      $('#menubar').append(non_login)
    }else{
      $('#menubar').append(html_logout)
      email_head("{{sessionemail2}}")
    }

  }

  function get_parameter(){
    if("{{para_data}}" == ""){
    }else{
      search_result = "{{para_data}}"
      bring_DB(search_result)
    }
  }

  function email_head(email){
   let temp_html = email;
   $('#customer_email').append(temp_html);
 }

   // 로그아웃 함수
   function btn_logout(){
    jbResult = confirm( "정말 로그아웃을 하시겠습니까?" );
    if(jbResult == true){
      $.ajax({
       type: "POST",
       url: "/test2",
       data: {},
       success: function(response){
        location.href="/"
      }
    })
    }
    else{
    }
  }

  // 검색 엔진 api
  function search_listing(){
    $('#comment_box').hide()
    $('#user_comment').show()
    $('#user_comment').val('')
    $('#save_button').show()
    $('#edit_comment_box').remove()
    $('#db_comment_box').remove()

    let search_data = $('#movie_input').val();
    let nickname = $('#customer_email').text();
    if( search_data != ""){
      alert(search_data+'에 대한 정보입니다.');
      $.ajax({
        type: "POST",
        url: "/search_movie",
        data: {
          search_title_give : search_data,
          nickname : nickname
        },
        success: function(response){
        }
      })
      go_search_page(search_data);
      // bring_DB(search_data);
    }
    else{
      alert('검색어를 입력해주세요.');
    }
  }

  function lastest_searching_listing() {
    $.ajax({
      type:"GET",
      url:"/lastest_searching_listing",
      data:{nickname:$('#customer_email').text()},
      success:function(response){
        // 로그인이 되어있을 때
        if(response['result']=='success'){
          search_list = response['list']
          // 최신 순으로 나오기 위해서, reverse() 사용
          search_list.reverse()
          if(search_list.length > 9 ){
            search_list_bar = '최근 검색어'
            search_list_1 = search_list[0]['search_movie']
            search_list_2 = search_list[1]['search_movie']
            search_list_3 = search_list[2]['search_movie']
            search_list_4 = search_list[3]['search_movie']
            search_list_5 = search_list[4]['search_movie']
            search_list_6 = search_list[5]['search_movie']
            search_list_7 = search_list[6]['search_movie']
            search_list_8 = search_list[7]['search_movie']
            search_list_9 = search_list[8]['search_movie']
            search_list_10 = search_list[9]['search_movie']

            bring_search_list_html(search_list_bar, search_list_1, search_list_2, search_list_3, search_list_4, search_list_5, search_list_6, search_list_7, search_list_8, search_list_9, search_list_10)
          }else{
            $('.lastest_searching_movie').append('<ul id="search_list_contents" style="padding-left:0px;margin-top:250px; margin-bottom:50%;">\
              <p style="font-weight:bold;font-size:large;">10개 이상 검색해야 해당 기능을 사용할 수 있습니다.</p>');
            for(let i = 0; i < search_list.length ;i++){

            }
          }
        }

        // 로그인이 되어있지 않을 때
        else if(response['result']=='fail'){
          alert('로그인을 먼저 진행해주세요!')
        }
      }
    })
  }

  function bring_search_list_html(search_bar,search_list_1,search_list_2,search_list_3,search_list_4,search_list_5,search_list_6,search_list_7,search_list_8,search_list_9,search_list_10){
    $('#search_list_contents').remove()
    search_list_html = '<ul id="search_list_contents" style="padding-left:0px;margin-top:30px;">\
    <p><a id="rank_bar" style="font-weight:bold;font-size:20pt;">'+'<'+search_bar+'>'+'</a></p><br>\
    <p><a href="/page5?search_data='+search_list_1+'" id="rank_first">'+search_list_1+'</a></p>\
    <p><a href="/page5?search_data='+search_list_2+'" id="rank_second">'+search_list_2+'</a></p>\
    <p><a href="/page5?search_data='+search_list_3+'" id="rank_third">'+search_list_3+'</a></p>\
    <p><a href="/page5?search_data='+search_list_4+'" id="rank_fourth">'+search_list_4+'</a></p>\
    <p><a href="/page5?search_data='+search_list_5+'" id="rank_fifth">'+search_list_5+'</a></p>\
    <p><a href="/page5?search_data='+search_list_6+'" id="rank_fifth">'+search_list_6+'</a></p>\
    <p><a href="/page5?search_data='+search_list_7+'" id="rank_fifth">'+search_list_7+'</a></p>\
    <p><a href="/page5?search_data='+search_list_8+'" id="rank_fifth">'+search_list_8+'</a></p>\
    <p><a href="/page5?search_data='+search_list_9+'" id="rank_fifth">'+search_list_9+'</a></p>\
    <p><a href="/page5?search_data='+search_list_10+'" id="rank_fifth">'+search_list_10+'</a></p>\
    </ul>'

    $('.lastest_searching_movie').append(search_list_html);

  }


  function bring_DB(data){
    $.ajax({
      type: "GET",
      url: "/search_DB",
      data: {movie_input:data,nickname:$('#customer_email').text()},
      success: function(response){
        if(response['result'] == 'success' && response['check_comment'] == 'success'){
          movie_infos = response['Movie_info'];
          let movie_comment = response['Movie_comment'];
          $('#movie_temp_html').html('');

          let title = movie_infos[0]['title']
          let poster = movie_infos[0]['poster']
          let director = movie_infos[0]['director']

          for(let i=0; i<movie_infos.length-(movie_infos.length-1); i++){movie_card(movie_infos[i]['poster'],movie_infos[i]['title'],movie_infos[i]['summary'],movie_infos[i]['director']);
            $('#search_movie_title').text(movie_infos[i]['title']);
          $('#comment_movie_title').text(movie_infos[i]['title']);

          comment_save(title,poster,director,movie_comment)
          $('#comment_box').show();
        }
        check_like_db();
        // return (title , movie_infos)
      }
      else if(response['result'] == 'success' && response['check_comment'] == 'fail'){
        movie_infos = response['Movie_info'];
        let title = movie_infos[0]['title'];

        $('#movie_temp_html').html('');

        for(let i=0; i<movie_infos.length-(movie_infos.length-1); i++){
          movie_card(movie_infos[i]['poster'],movie_infos[i]['title'],movie_infos[i]['summary'],movie_infos[i]['director']);
          $('#search_movie_title').text("<"+movie_infos[i]['title']+">");
          $('#comment_movie_title').text(movie_infos[i]['title']);
        }

        check_like_db();
        // return (title , movie_infos)   
      }

      else{
        alert('영화를 검색해주세요.')
      }
      return movie_infos;
    }
  })
    
  }

  // 영화의 장르를 분석해주는 함수

  function search_genre(){
    title = $('#card_movie_title').text()
    nickname = nickname

      // 점수를 추가할지 뺄지 나누기 위해서, if 구문 작성

      if($('#like').hasClass('is-active')){
        check = 'plus'
      }else{
        check = 'minus'
      }

      $.ajax({
        type:"POST",
        url: "/get_movie_genre",
        data: {
          movie_title : title,
          nickname : nickname,
          check : check
        },
        success:function(response){
          if(response['result'] == 'success'){
          }
          else if(response['result'] == 'fail'){
          }
        }
      })
    }

    function like_movie(){
      $.ajax({
       type: "POST",
       url: "/like_movie",
       data: {
        nickname:$('#customer_email').text(),
        title:movie_infos[0]['title'],
        poster:movie_infos[0]['poster'],
        director:movie_infos[0]['director']
      },
      success: function(response){
        if (response['result'] == 'success'){
          alert('성공적으로 영화가 담겼습니다')
          search_genre()
          alert('장르 값을 추가했습니다.')

        }
        else if (response['result'] == 'fail2'){
          alert('이미 좋아한다고 누름')
        }
        else if (response['result'] == 'fail1'){
          DL(movie_infos[0]['title'] , movie_infos[0]['poster'])
        }
      }
    })
    }

    function dislike_movie(){
      $.ajax({
       type: "POST",
       url: "/dislike_movie",
       data: {
        nickname:$('#customer_email').text(),
        title:movie_infos[0]['title'],
        poster:movie_infos[0]['poster']
      },
      success: function(response){
        if (response['result'] == 'success'){
          alert('성공적으로 영화가 담겼습니다')
          search_genre()
          alert('장르 값을 뺏습니다.')
        }
        else if (response['result'] == 'fail1'){
          alert('이미 안좋아한다고 누름')
        }
        else if (response['result'] == 'fail2'){
          LD(movie_infos[0]['title'], movie_infos[0]['poster'])
        }
      }
    })
    }

    function DL(title,poster){
     jbResult = confirm("싫어요에 담겨있는 영화입니다. 좋아하는 영화에 담을까요 ?");
     search_genre();
     alert('장르 값을 더했습니다.');
     if (jbResult == true){
      $.ajax({
       type: "POST",
       url: "/DLupdate_movie",
       data: {title:title, poster:poster},
       success: function(response){
         if (response['result'] == 'success'){
          return true
        }
      }
    })
    }
  }

  function LD(title,poster){
   jbResult = confirm("좋아요에 담겨있는 영화입니다. 싫어하는 영화에 담을까요 ?");
   search_genre();
   alert('장르 값을 뺏습니다.');
   if (jbResult == true){
    $.ajax({
     type: "POST",
     url: "/LDupdate_movie",
     data: {title:title, poster:poster},
     success: function(response){
       if (response['result'] == 'success'){
        return true
      }
    }
  })
  }
}


// 나무 위키 클릭 함수
function namu_wiki_click(){
  movie_title = $('#search_movie_title').text()
  namu_wiki_url="https://namu.wiki/w/"+ movie_title
  location.href=namu_wiki_url
}

// 구글 클릭 함수
function google_click(){
  movie_title = $('#search_movie_title').text()
  google_url = "https://play.google.com/store/search?q="+movie_title+"&c=movies&hl=ko"
  location.href=google_url
}

function get_others_comment(title){
 $.ajax({
   type: "POST",
   url: "/get_comments",
   data: {title:title},
   success: function(response){
     if (response['result'] == 'success'){
      others_comments = response['others_comments'];
      console.log(others_comments)
      divide_comments(others_comments)

    }
  }
})
}

function divide_comments(others_comments){

  $('#others_comment').html('')

  console.log(others_comments)

  for(let i=0 ; i < others_comments.length ; i++){
    console.log(others_comments[i]['user_nickname'])
    console.log(others_comments[i]['user_comment'])
    a= others_comments[i]['user_nickname']
    b= others_comments[i]['user_comment']
    c= others_comments[i]['gonggam_cnt']
    display_comments(a,b,i,c)
    check_like_db2(i);

  }
}

function display_comments(a,b,count,c){
  console.log(count)
  $('#others_comment').append('<div class="media-body" style="width:33%; float:left; padding:50px"><img src="static/user_image.jpg" style="width:45px; float:left ; border-radius:50%"><h5 class="mt-0 mb-1" id="comment_titles">' + '&nbsp&nbsp&nbsp<strong>' + a + '</strong><div style="margin-top:30px"><hr width="100%" color="white"></div></h5><div id="comment_comments" style="padding:10% ; word-break:break-all;">' + b + '</div><div style="margin-top:15%">\
    <div class="container">\
    좋아요 수 : '+c+'\
    <div class="wrapper" style="display:inline-block; vertical-align:middle;">\
    <a href="javascript:void(0);" onclick="like_animation1('+count+')"class="like-button" id="like'+count+'" style=" margin-left:100px;">\
    <i class="material-icons not-liked bouncy">favorite_border</i>\
    <i class="material-icons is-liked bouncy">favorite</i>\
    <span class="like-overlay"></span>\
    </a>\
    </div>\
    </div>\
    </div></div>')

}


function check_like_db2(num){
  $.ajax({
   type: "POST",
   url: "/check_comment",
   data: {
    title:movie_infos[0]['title'],
    num:num
  },
  success: function(response){
    if(response['result']=='like_success'){
      $('#like'+num).toggleClass('is-active');
    }else if (response['result']=='like_fail'){

    }else{
    }
  }
})

}

function like_animation1(num){

  console.log('!!!!!!!!!!!!!')
  console.log(num)
  $('#like'+num).toggleClass('is-active');
  check_like1(num);
};

function check_like1(num){
  if($('#like'+num).hasClass('is-active')){
    comment_like(num)
  }else{
    comment_like2(num)
  }
}



function comment_like(count){
  $.ajax({
   type: "POST",
   url: "/comment_like_counting",
   data: {nickname:others_comments[count]['user_nickname'], title:others_comments[count]['user_comment_movie_title']},
   success: function(response){
    if (response['result'] == 'success'){
     alert('좋아요가 반영되었습니다')
     location.reload()
   }
 }
})
}

function comment_like2(count){
  $.ajax({
   type: "POST",
   url: "/comment_dislike_counting",
   data: {nickname:others_comments[count]['user_nickname'], title:others_comments[count]['user_comment_movie_title']},
   success: function(response){
    if (response['result'] == 'success'){
     alert('좋아요가 취소되었습니다')
     location.reload()
   }
 }
})
}




</script>


<style type="text/css">

  *{
    font-family: 'Noto Serif KR', serif;
  }
  
  #menubar{
    color: black;
    font-weight: bold;
  }

  #comment_box{
    display: none;
    margin-left:450px;
    width:1100px;
    height: 421px;
  }

  .nav-masthead {
   float: right;
 }

 .page_title{
  margin-top: 40px;
  color: black;
  text-align: center;
  font-size: 50pt;
  font-weight: bold;

}

.main_contents{
  display: flex;
  border: 3px solid black;
  border-radius: 30px;
  width:1100px;
  margin-right:auto;
  margin-left: 450px;
  margin-top : 50px;
  margin-bottom: 50px;
  padding: 50px 30px 30px 30px;
  background-color:#89a3b2;
}
.search_movie_title{
  font-size: 30pt;
  font-weight: bold;
  color:black;
  margin-top: 5px;
  text-align: center;
}
.search_movie_info_text{
  font-size: 20px;
  font-weight: bold;
  color: #89a3b2;
  margin-top: 5px;
  text-align: center;
}
.prefer_button{
  float: left;
}
#card_size{
  width: 1000px;
  background-color:#89a3b2;
  border: 1px solid #89a3b2;
}
#like_movie{
  background-color: #B7CBFF;
  align-content: right;
}

#dislike_movie{
  background-color: #FFB7B7;
}
#comment_button{
  width: 150px;
  height: 50px;
  margin-left:180px;
  margin-top:10px;
  font-weight:bold;
  border-radius: 5px;

  border: 1px solid #d2f7e1; 
  background-color: rgba(0,0,0,0);
  color: #d2f7e1; 
  padding: 3px;

}

#comment_button:hover{
  color:black;
  background-color: #d2f7e1;
}

.card_summary{
  font-weight:bold;
}
.card_title{
  font-weight: bold;
}

.prefer_button{
  float: right;
}

.movie_info{
  /*  position: absolute;*/
/*  margin-left:auto;
margin-right:auto;*/
}

#movie_input{
  text-align: center;
  border: 3px solid #7d7d89;
  width: 800px;
  height: 55px;
}
.home_logo img{
  margin: 10px 0 0 8px;
  position: relative;
  float: left;
  background-size: 173px 26px;
  width: 80px;
  height: 52px;
}
.masthead-brand {
 float: left;
}

#customer_email{
 color: white;
 text-align: right;
 margin-top:10px;
}

.contents .jumbotron{
  background-color:#89a3b2;
}

.display-4{
  font-weight: bold;
}

.lastest_searching_movie{
  float:right;
  width:300px;
  height: 600px;
  margin-right: 15px;
  margin-top:45px;
  border: 3px solid black;
  text-align: center;
}

.movie_comment{
  color: black;
  width: 1100px;
  height: 421px;
  margin-right: 345px;
  margin-left: 450px;
  margin-top : 50px;
  margin-bottom: 50px;
}

#google_link{
  border:0px solid;
  float: right;
  background-color: #89a3b2;
}

#namu_wiki_link{
 border:0px solid;
 float: right;
 background-color: #89a3b2;
}

textarea{
  width: 60%;
  height: 100px;
}

input[type=text]{
  height: 40px;
}


img{
  -webkit-perspective: 1;
}

#like_button{
  margin-right: 20px;
  cursor: pointer; 
  background: rgba(255,255,255,0.3);
  background-size: 50%;       
  border-radius: 50%;
  text-align: center;
  line-height: 75px;
  z-index: 10;
  color: blue;
}

#dislike_button{
  margin-right: 20px;
  cursor: pointer; 
  background: rgba(255,255,255,0.3);       
  border-radius: 50%;
  text-align: center;
  line-height: 75px;
  z-index: 10;
  color: red;
}

/*추가한 부분*/
.container {
  width: 600px;
  height: auto;
}
.container h1 {
  font-family: 'Lato';
  font-size: 3rem;
  font-weight: 300;
}
.container h4 {
  font-family: 'Lato';
  font-soze: 1.2rem;
  padding-top: 40px;
  color: #999;
}
.container .love {
  font-size: 0.9rem;
  color: #ff4f8f;
}
.container .wrapper .like-button {
  /*누르면 나오는 애니메이션 크기*/
  position: relative;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #ccc;
  display: -webkit-box;
  display: flex;
  -webkit-box-pack: center;
  justify-content: center;
  -webkit-box-align: center;
  align-items: center;
  margin: 0 auto;
  text-decoration: none;
  overflow: hidden;
}
.container .wrapper .like-button .like-overlay {
  display: block;
  position: absolute;
  top: 0;
  left: 0;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #ff4f8f;
  -webkit-transform: scale(0);
  transform: scale(0);
  -webkit-transition: all .4s;
  transition: all .4s;
  z-index: 0;
}
.container .wrapper .like-button i.not-liked {
  display: block;
  color: #fff;
  position: relative;
  z-index: 1;
}
.container .wrapper .like-button i.is-liked {
  display: none;
  color: #fff;
  position: relative;
  z-index: 1;
}
.container .wrapper .like-button.is-active .like-overlay {
  -webkit-transform: scale(1);
  transform: scale(1);
}
.container .wrapper .like-button.is-active i.not-liked {
  display: none;
}
.container .wrapper .like-button.is-active i.is-liked {
  display: block;
}

@-webkit-keyframes bouncy {
  from, to {
    -webkit-transform: scale(1, 1);
  }
  25% {
    -webkit-transform: scale(0.9, 1.1);
  }
  50% {
    -webkit-transform: scale(1.1, 0.9);
  }
  75% {
    -webkit-transform: scale(0.95, 1.05);
  }
}
@keyframes bouncy {
  from, to {
    -webkit-transform: scale(1, 1);
    transform: scale(1, 1);
  }
  25% {
    -webkit-transform: scale(0.9, 1.1);
    transform: scale(0.9, 1.1);
  }
  50% {
    -webkit-transform: scale(1.1, 0.9);
    transform: scale(1.1, 0.9);
  }
  75% {
    -webkit-transform: scale(0.95, 1.05);
    transform: scale(0.95, 1.05);
  }
}
.bouncy {
  -webkit-animation: bouncy 0.6s;
  animation: bouncy 0.6s;
  -webkit-animation-duration: 0.6s;
  animation-duration: 0.6s;
  -webkit-animation-fill-mode: both;
  animation-fill-mode: both;
}

.link-button {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #6dacff;
  position: absolute;
  bottom: 20px;
  right: 20px;
  display: -webkit-box;
  display: flex;
  -webkit-box-pack: center;
  justify-content: center;
  -webkit-box-align: center;
  align-items: center;
  -webkit-transition: all .4s;
  transition: all .4s;
}
.link-button img {
  width: 32px;
  height: 32px;
  display: block;
}
.link-button:hover {
  -webkit-transform: scale(1.1) rotate(180deg);
  transform: scale(1.1) rotate(180deg);
  background: #ff4f8f;
}



</style>


</head>
<body style="background-color:#c5adba">
  <div class="movie_info" style="margin-top:25px;">
    <div class="movie_info" style="margin-top:25px;">
      <div class="movie_top" style="margin-left: 25%;">
        <img src="static/logo.png" style="width:100px; height:80px; cursor: pointer;" onclick="btn_home()">
        <input class="keyword" id="movie_input" width="2em" height="2em"
        style="margin-right: 7px; margin-left: 10px;" type="text" name="movie_info_give" maxlength=255
        value="" autocomplete="off" placeholder="'영화제목'  / '감독' / '사용자' 를 입력해주세요."
        onKeypress="javascript:if(event.keyCode==13) {search_listing()}">
        <svg class="bi bi-search" onclick="" width="2em" height="2em"
        style="margin-top:13px;margin-right: 7px; margin-left: 10px; cursor: pointer;" viewBox="0 0 16 16"
        fill="currentColor" onclick="search_listing()" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd"
        d="M10.442 10.442a1 1 0 0 1 1.415 0l3.85 3.85a1 1 0 0 1-1.414 1.415l-3.85-3.85a1 1 0 0 1 0-1.415z"/>
        <path fill-rule="evenodd"
        d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
      </svg>
      <nav class="nav nav-masthead justify-content-center" id="menubar">
        <svg class="bi bi-person-circle" width="2em" height="2em" style="padding-top:10px;padding-right: 5px;"
        viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
        <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
        <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
        <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
      </svg>
      <p id="customer_email" style="cursor: pointer;" onclick="btn_mypage(nickname)"></p>
    </nav>
  </div>
</div>
<div class="movie_title_set">
  <div class="page_title" style="font-size: 40px;"> Movie Info...</div>
  <div class="search_movie_info">
    <div class="search_movie_title" id="search_movie_title"></div>
    <div class="search_movie_info_text"></div>
  </div>
  <div class="lastest_searching_movie"></div>
  <div class="main_contents" id="movie_temp_html">

  </div>
</div>

<div class="movie_comment" id="comment_box">
  <div class="jumbotron" id="comment_jumbo" style="background-color:#89a3b2; border: 2px solid black;">
    <h3 class="display-4" id="comment_movie_title"></h3><br>
    <p class="lead">이 작품에 대한 생각을 자유롭게 적어주세요.</p>
    <hr class="my-4">
    <div id="change_box">
      <p id="user_comment_box">
        <textarea class="comment_area" id="user_comment" placeholder="영화에 대한 코멘트를 남겨주세요."></textarea>
      </p><br>
      <a class="btn btn-primary btn-lg" id="save_button" href="#" role="button"
      onclick="comment_info()">저장하기</a>
    </div>
  </div>
</div>


<div style="margin-top:10%">
  <div>
    <h3 style="text-align:center"><strong>Others' Comments</strong></h3>
    <div>
      <hr width="150" color="white">
    </div>

    <div class="others_comment" id="others_comment" style="margin-top:5%; margin-left:20% ; margin-right:20%">
      <!--        <div class="col-md-4">-->
        <div class="media-body" id="test" style="width:100px">
          <h5 class="mt-0 mb-1" id="comment_titles">Media object</h5>
          <div id="comment_comments">
          </div>
          <div style="margin-top:5%; margin-left:5%">
            <button id="comment_like" onclick="comment_like()"><img src="static/user_image.jpg" class="aaa"
              style="width:40px"></button>
            </div>
            <div class="others_comment" id="others_comment" style="margin-top:5%; margin-left:20% ; margin-right:20%">
              <div class="media-body" id="test" style="width:100px">
                <h5 class="mt-0 mb-1" id="comment_titles">Media object</h5>
                <div id="comment_comments">
                </div>
                <div style="margin-top:5%; margin-left:5%">
                </div>

              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
